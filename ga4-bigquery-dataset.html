<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>GA4 BigQuery Dataset Build | Jenniefer Farhan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Case study: Building a reproducible marketing analytics dataset using Google GA4 BigQuery sample data.">

  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <nav class="nav-wrap">
    <a href="index.html" class="brand">Jenniefer <span>Farhan.</span></a>
    <a href="index.html" class="btn-link">← Back to Home</a>
  </nav>

  <main class="container">
    <header style="padding: 4rem 0 2.5rem;">
      <span class="label">Marketing Operations & Analytics</span>
      <h1 class="h1">GA4 BigQuery Dataset Build<br>for Campaign Analysis</h1>
      <p class="project-desc" style="max-width: 78ch;">
        This page documents how I accessed Google's public GA4 sample ecommerce dataset in BigQuery using direct table references,
        validated query access, and prepared analysis-ready outputs for marketing funnel reporting (sessions, purchases, revenue, conversion rate).
      </p>
      <div style="margin-top: 1.5rem;">
        <a class="btn-link" href="digital-campaign-analysis.html">View Campaign Analysis Page →</a>
      </div>
    </header>

    <div class="section">
      <h2 class="h2">Step 1 — Open BigQuery Studio and select a project</h2>
      <p class="project-desc">
        I opened BigQuery Studio in Google Cloud Console and confirmed the correct project context was selected.
        This is required because BigQuery queries always run under a Google Cloud project.
      </p>

      <div class="shot-grid">
        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-01-bigquery-studio.png" data-title="BigQuery Studio with project selected">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-01-bigquery-studio.png" alt="BigQuery Studio with project selected">
            </div>
          </button>
          <div class="shot-cap">BigQuery Studio open with the correct project selected.</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="h2">Step 2 — Access the public GA4 dataset directly</h2>
      <p class="project-desc">
        BigQuery public datasets can be queried directly using fully-qualified table references. In this case study,
        I accessed Google's GA4 sample ecommerce export by querying the public dataset tables directly (no UI pinning required).
      </p>

      <div class="codeblock">
        <pre><code>SELECT
  COUNT(*) AS rows_in_dataset
FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`;</code></pre>
      </div>

      <div class="shot-grid">
        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-02-access-public-dataset.png" data-title="Direct access to the public GA4 dataset">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-02-access-public-dataset.png" alt="Direct access query for public GA4 dataset">
            </div>
          </button>
          <div class="shot-cap">Direct dataset access confirmed via a lightweight row-count query.</div>
        </div>
      </div>

      <div class="callout">
        <h3 class="h3">Dataset Reference</h3>
        <p class="project-desc">
          <strong>`bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`</strong>
        </p>
      </div>

      <div class="codeblock">
        <pre><code>SELECT
  event_name,
  COUNT(*) AS events
FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`
GROUP BY event_name
ORDER BY events DESC;</code></pre>
      </div>

      <div class="shot-grid">
        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-03-querying-ga4-dataset.png" data-title="Event distribution query (purchase, page_view, etc.)">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-03-querying-ga4-dataset.png" alt="Event distribution query results">
            </div>
          </button>
          <div class="shot-cap">Event distribution confirms the dataset structure (e.g., purchase, page_view, session_start).</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="h2">Step 3 — Validate access with a sanity query</h2>
      <p class="project-desc">
        Before building any reporting tables, I ran a lightweight query to confirm access and inspect event distribution by date and event type.
      </p>

      <div class="codeblock">
        <pre><code>SELECT
  event_date,
  event_name,
  COUNT(*) AS events
FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`
GROUP BY event_date, event_name
ORDER BY event_date
LIMIT 50;</code></pre>
      </div>

      <div class="shot-grid">
        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-04-sanity-query.png" data-title="Sanity query in editor">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-04-sanity-query.png" alt="Sanity query in editor">
            </div>
          </button>
          <div class="shot-cap">Sanity query pasted into the BigQuery editor.</div>
        </div>

        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-05-sanity-results.png" data-title="Sanity query results">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-05-sanity-results.png" alt="Sanity query results">
            </div>
          </button>
          <div class="shot-cap">Results returned successfully, confirming dataset access.</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="h2">Step 4 — Build an analysis-ready marketing funnel table</h2>
      <p class="project-desc">
        GA4 exports are event-based. To support campaign-style reporting, raw events must be reshaped into a daily funnel table:
        <strong>date → channel → sessions → purchases → revenue → conversion_rate</strong>.
        This step documents the logic used to reconstruct sessions, isolate conversions, and compute funnel KPIs in a reproducible way.
      </p>

      <div class="callout">
        <h3 class="h3">Output Schema</h3>
        <div class="pillrow">
          <span class="pill"><strong>date</strong> DATE</span>
          <span class="pill"><strong>channel</strong> STRING</span>
          <span class="pill"><strong>sessions</strong> INT</span>
          <span class="pill"><strong>purchases</strong> INT</span>
          <span class="pill"><strong>revenue</strong> NUMERIC</span>
          <span class="pill"><strong>conversion_rate</strong> FLOAT</span>
        </div>
        <p class="mini">
          Sessions are reconstructed using <strong>user_pseudo_id</strong> + <strong>ga_session_id</strong>.
          Channel is derived from <strong>traffic_source.source</strong> and <strong>traffic_source.medium</strong>.
          Conversions are <strong>purchase</strong> events, and revenue comes from <strong>ecommerce.purchase_revenue</strong>.
        </p>
      </div>

      <h3 class="h3" style="margin-top: 2.5rem;">4.1 Reconstruct sessions (GA4 session_key)</h3>
      <p class="project-desc">
        GA4 does not store sessions as rows. To count sessions reliably, I rebuilt a session identifier (session_key) from
        <strong>user_pseudo_id</strong> and the event parameter <strong>ga_session_id</strong>, then aggregated sessions by date and channel.
      </p>

      <div class="codeblock">
        <pre><code>WITH base_events AS (
  SELECT
    PARSE_DATE('%Y%m%d', event_date) AS date,
    user_pseudo_id,
    (SELECT value.int_value
     FROM UNNEST(event_params)
     WHERE key = 'ga_session_id') AS session_id,
    traffic_source.source AS source,
    traffic_source.medium AS medium
  FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`
),

sessions AS (
  SELECT DISTINCT
    date,
    CONCAT(
      COALESCE(source, 'direct'),
      ' / ',
      COALESCE(medium, 'none')
    ) AS channel,
    CONCAT(user_pseudo_id, '-', session_id) AS session_key
  FROM base_events
  WHERE session_id IS NOT NULL
)

SELECT
  date,
  channel,
  COUNT(DISTINCT session_key) AS sessions
FROM sessions
GROUP BY date, channel
ORDER BY date, sessions DESC;</code></pre>
      </div>

      <h3 class="h3" style="margin-top: 2.5rem;">4.2 Isolate conversions and revenue</h3>
      <p class="project-desc">
        Purchases are counted from <strong>purchase</strong> events. Revenue is sourced from <strong>ecommerce.purchase_revenue</strong>.
      </p>

      <div class="codeblock">
        <pre><code>SELECT
  PARSE_DATE('%Y%m%d', event_date) AS date,
  COUNT(*) AS purchases,
  SUM(ecommerce.purchase_revenue) AS revenue
FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`
WHERE event_name = 'purchase'
GROUP BY date
ORDER BY date;</code></pre>
      </div>

      <h3 class="h3" style="margin-top: 2.5rem;">4.3 Build the final daily funnel table</h3>

      <div class="codeblock">
        <pre><code>WITH sessions AS (
  SELECT
    PARSE_DATE('%Y%m%d', event_date) AS date,
    CONCAT(
      COALESCE(traffic_source.source, 'direct'),
      ' / ',
      COALESCE(traffic_source.medium, 'none')
    ) AS channel,
    COUNT(DISTINCT CONCAT(
      user_pseudo_id, '-',
      (SELECT value.int_value
       FROM UNNEST(event_params)
       WHERE key = 'ga_session_id')
    )) AS sessions
  FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`
  GROUP BY date, channel
),

purchases AS (
  SELECT
    PARSE_DATE('%Y%m%d', event_date) AS date,
    COUNT(*) AS purchases,
    SUM(ecommerce.purchase_revenue) AS revenue
  FROM `bigquery-public-data.ga4_obfuscated_sample_ecommerce.events_*`
  WHERE event_name = 'purchase'
  GROUP BY date
)

SELECT
  s.date,
  s.channel,
  s.sessions,
  COALESCE(p.purchases, 0) AS purchases,
  COALESCE(p.revenue, 0) AS revenue,
  SAFE_DIVIDE(p.purchases, s.sessions) AS conversion_rate
FROM sessions s
LEFT JOIN purchases p
  ON s.date = p.date
ORDER BY s.date, s.sessions DESC;</code></pre>
      </div>
    </div>

    <div class="section">
      <h2 class="h2">Step 5 — Export query outputs as CSV artifacts</h2>
      <p class="project-desc">
        After shaping query results into analysis-ready tables, I exported the outputs as CSV so the dataset can be used in
        Excel/Power BI and linked as downloadable evidence from the portfolio site.
      </p>

      <div class="shot-grid">
        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-06-export-menu.png" data-title="Export menu showing CSV option">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-06-export-menu.png" alt="Export menu showing CSV option">
            </div>
          </button>
          <div class="shot-cap">Export menu opened from the BigQuery results panel (CSV option visible).</div>
        </div>

        <div class="shot-card">
          <button class="shot-btn" data-full="assets/screens/ga4-07-export-csv.png" data-title="Exported CSV opened for verification">
            <div class="shot-imgwrap">
              <img class="shot-img" src="assets/screens/ga4-07-export-csv.png" alt="Exported CSV opened for verification">
            </div>
          </button>
          <div class="shot-cap">Exported CSV opened to verify columns and output structure.</div>
        </div>
      </div>

      <div class="callout">
        <h3 class="h3">Download the datasets</h3>
        <p class="project-desc">
          These CSV files are the analysis-ready outputs exported from BigQuery and used to support the campaign performance reporting.
        </p>
        <ul class="dataset-list">
          <li>
            <a href="assets/ga4_sessions_by_day_channel.csv" download>ga4_sessions_by_day_channel.csv</a>
            <div class="dataset-meta">Daily sessions by channel (source/medium) reconstructed from ga_session_id.</div>
          </li>
          <li>
            <a href="assets/ga4_purchases_revenue_by_day.csv" download>ga4_purchases_revenue_by_day.csv</a>
            <div class="dataset-meta">Daily purchases and revenue totals derived from purchase events.</div>
          </li>
          <li>
            <a href="assets/ga4_funnel_by_day_channel.csv" download>ga4_funnel_by_day_channel.csv</a>
            <div class="dataset-meta">Final daily funnel table: sessions + purchases + revenue + conversion rate.</div>
          </li>
        </ul>
      </div>
    </div>

    <footer>
      <p>&copy; <script>document.write(new Date().getFullYear())</script> Jenniefer Farhan.<br>Designed for clarity and precision.</p>
    </footer>
  </main>

  <!-- Modal Viewer -->
  <div class="viewer" id="viewer" aria-hidden="true">
    <div class="viewer__panel" role="dialog" aria-modal="true" aria-label="Image viewer">
      <div class="viewer__top">
        <div class="viewer__title" id="viewerTitle"></div>
        <button class="viewer__close" id="viewerClose" aria-label="Close image viewer">×</button>
      </div>
      <div class="viewer__imgwrap">
        <img class="viewer__img" id="viewerImg" alt="">
      </div>
    </div>
  </div>

  <script>
    (function(){
      const viewer = document.getElementById('viewer');
      const viewerImg = document.getElementById('viewerImg');
      const viewerTitle = document.getElementById('viewerTitle');
      const viewerClose = document.getElementById('viewerClose');

      function openViewer(src, title){
        viewer.classList.add('is-open');
        viewer.setAttribute('aria-hidden', 'false');
        viewerImg.src = src;
        viewerImg.alt = title || 'Screenshot';
        viewerTitle.textContent = title || '';
        document.body.style.overflow = 'hidden';
      }

      function closeViewer(){
        viewer.classList.remove('is-open');
        viewer.setAttribute('aria-hidden', 'true');
        viewerImg.src = '';
        viewerTitle.textContent = '';
        document.body.style.overflow = '';
      }

      document.querySelectorAll('.shot-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const src = btn.getAttribute('data-full');
          const title = btn.getAttribute('data-title');
          openViewer(src, title);
        });
      });

      viewerClose.addEventListener('click', closeViewer);

      viewer.addEventListener('click', (e) => {
        if(e.target === viewer) closeViewer();
      });

      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape' && viewer.classList.contains('is-open')){
          closeViewer();
        }
      });
    })();
  </script>

</body>
</html>
